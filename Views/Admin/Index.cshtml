@{
    // Bu View, Admin/Index eyleminin döndürdüğü görünümdür.
    // Başlık ve layout bilgileri mevcut controller ve view yapına göre korunmuştur.
    ViewBag.Title = "Ana Sayfa";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    /* Gradient Arka Planlar ve Gölgeler */
    .card-stat-1 {
        background: linear-gradient(45deg, #0d6efd, #00bfff);
        color: white;
    }
    /* Mavi */
    .card-stat-2 {
        background: linear-gradient(45deg, #ffc107, #ff9800);
        color: white;
    }
    /* Sarı */
    .card-stat-3 {
        background: linear-gradient(45deg, #198754, #4caf50);
        color: white;
    }
    /* Yeşil */
    .card-stat-4 {
        background: linear-gradient(45deg, #dc3545, #f44336);
        color: white;
    }
    /* Kırmızı */
    .card-stat-general {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
    }
    /* Genel kartlar için hafif arka plan */

    /* Kartların Genel Görünümü */
    .stat-card {
        border-radius: 1rem !important; /* Daha yuvarlak köşeler */
        transition: transform 0.3s, box-shadow 0.3s;
    }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 1rem 3rem rgba(0,0,0,0.175) !important;
        }

    .card-header-styled {
        background-color: #007bff; /* Mavi Başlık */
        color: white;
        border-bottom: 0;
        border-radius: 1rem 1rem 0 0 !important;
    }

    /* En Çok Satılanlar Listesi Stil */
    .product-list-item {
        border-left: 5px solid #007bff;
        transition: background-color 0.2s;
    }

        .product-list-item:hover {
            background-color: #e9ecef;
        }
</style>


<div class="container-fluid px-4">
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
        <h1 class="h2 mb-0 fw-light text-primary"><i class="bi bi-speedometer2 me-2"></i> Yönetici Paneli - Genel Bakış</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/Admin/Index" class="text-decoration-none"><i class="bi bi-house-fill"></i> Ana Sayfa</a></li>
                <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
            </ol>
        </nav>
    </div>

    <div class="card stat-card shadow-sm mb-5 bg-light-blue border-0">
        <div class="card-body p-4">
            <div class="d-flex align-items-center">
                <i class="bi bi-chat-square-quote-fill fs-3 text-primary me-3"></i>
                <blockquote class="blockquote mb-0">
                    <p id="dailyQuote" class="mb-0 fs-5 fw-light text-dark">Günün sözü yükleniyor...</p>
                </blockquote>
            </div>
        </div>
    </div>


    <div class="row g-4 mb-5">

        <div class="col-xl-3 col-md-6">
            <div class="card stat-card card-stat-1 shadow-lg h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <p class="text-uppercase fw-semibold mb-1 opacity-75">Nakit Toplam</p>
                            <h3 class="fw-bold">@String.Format("{0:C}", ViewBag.NakitToplam ?? 0)</h3>
                        </div>
                        <i class="bi bi-cash-coin fs-1 opacity-50"></i>
                    </div>
                </div>
                <a href="/GelirGider/RaporPaneli" class="card-footer bg-white bg-opacity-25 border-0 text-white fw-semibold text-decoration-none p-3 rounded-bottom-4">
                    Detayları Gör <i class="bi bi-arrow-right-short ms-1"></i>
                </a>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card stat-card card-stat-2 shadow-lg h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <p class="text-uppercase fw-semibold mb-1 opacity-75">Kart Toplam</p>
                            <h3 class="fw-bold">@String.Format("{0:C}", ViewBag.KartToplam ?? 0)</h3>
                        </div>
                        <i class="bi bi-credit-card fs-1 opacity-50"></i>
                    </div>
                </div>
                <a href="/GelirGider/RaporPaneli" class="card-footer bg-white bg-opacity-25 border-0 text-white fw-semibold text-decoration-none p-3 rounded-bottom-4">
                    Detayları Gör <i class="bi bi-arrow-right-short ms-1"></i>
                </a>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card stat-card card-stat-3 shadow-lg h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <p class="text-uppercase fw-semibold mb-1 opacity-75">Veresiye Toplam</p>
                            <h3 class="fw-bold">@String.Format("{0:C}", ViewBag.VeresiyeToplam ?? 0)</h3>
                        </div>
                        <i class="bi bi-journal-text fs-1 opacity-50"></i>
                    </div>
                </div>
                <a href="/GelirGider/RaporPaneli" class="card-footer bg-white bg-opacity-25 border-0 text-white fw-semibold text-decoration-none p-3 rounded-bottom-4">
                    Detayları Gör <i class="bi bi-arrow-right-short ms-1"></i>
                </a>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card stat-card card-stat-4 shadow-lg h-100">
                <div class="card-body">
                    <p class="text-uppercase fw-semibold mb-2 opacity-75">En Çok Veresiye</p>
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="fw-bold mb-0">@ViewBag.EnCokVeresiyeAlanMusteri</h5>
                            <small class="opacity-75">Borç: @String.Format("{0:C}", ViewBag.EnCokVeresiyeAlanMusteriBorcu ?? 0)</small>
                        </div>
                        <i class="bi bi-person-fill-exclamation fs-1 opacity-50"></i>
                    </div>
                </div>
                <a href="/Musteri/MusteriGetir/@ViewBag.EnCokVeresiyeAlanMusteriID" class="card-footer bg-white bg-opacity-25 border-0 text-white fw-semibold text-decoration-none p-3 rounded-bottom-4">
                    Müşteri Detayları <i class="bi bi-arrow-right-short ms-1"></i>
                </a>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">

        <div class="col-xl-6">
            <div class="card stat-card card-stat-general shadow h-100">
                <div class="card-header card-header-styled">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-graph-up me-2"></i> Güncel İşlem Özeti (@DateTime.Today.ToShortDateString())</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row">
                        <div class="col-md-6 border-end">
                            <h6 class="text-primary fw-bold mb-3">Günlük Finansal Durum</h6>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                    <span class="fw-semibold"><i class="bi bi-check2-circle text-success me-2"></i>Toplam Satış (Bugün):</span>
                                    <strong class="text-success fs-5">@String.Format("{0:C}", ViewBag.GununToplamSatis ?? 0)</strong>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                    <span><i class="bi bi-arrow-up-right-circle text-info me-2"></i>Diğer Gelirler (Bugün):</span>
                                    <strong class="text-info">@String.Format("{0:C}", ViewBag.GununToplamGelir ?? 0)</strong>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center px-0 pt-3 border-top mt-2">
                                    <span class="fw-semibold"><i class="bi bi-dash-circle text-danger me-2"></i>Günlük Toplam Gider:</span>
                                    <strong class="text-danger">@String.Format("{0:C}", (ViewBag.gununKartGiderleri + ViewBag.gununNakitGiderleri + ViewBag.gununKasaGider) ?? 0)</strong>
                                </li>
                            </ul>
                        </div>

                        <div class="col-md-6">
                            <h6 class="text-primary fw-bold mb-3">Yoğunluk ve Ortalama Analizi</h6>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                    <i class="bi bi-clock-history me-2 text-warning"></i> Ortalama Günlük Satış:
                                    <span class="badge bg-warning text-dark">@ViewBag.OrtalamaGunlukSatisSayisi adet</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                    <i class="bi bi-calendar-day me-2 text-info"></i> Bugünün En Yoğun Saati:
                                    <span class="badge bg-info">@ViewBag.GununEnYogunSaatAraligi</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                    <i class="bi bi-calendar-range me-2 text-info"></i> Genel En Yoğun Saat:
                                    <span class="badge bg-info">@ViewBag.GenelEnYogunSaatAraligi</span>
                                </li>
                            </ul>
                            <div class="d-grid gap-2 mt-4">
                                <a href="@Url.Action("RaporPaneli", "GelirGider")" class="btn btn-outline-primary btn-sm fw-semibold">
                                    <i class="bi bi-bar-chart-line me-2"></i> Tüm Raporlara Git
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-6">
            <div class="card stat-card card-stat-general shadow h-100">
                <div class="card-header card-header-styled">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-bag-check-fill me-2"></i> En Çok Satılan 10 Ürün</h5>
                </div>
                <ul class="list-group list-group-flush">
                    @if (ViewBag.EnCokSatilanUrunler != null && ((List<KeyValuePair<string, int>>)ViewBag.EnCokSatilanUrunler).Any())
                    {
                        int index = 1;
                        foreach (var urun in (List<KeyValuePair<string, int>>)ViewBag.EnCokSatilanUrunler)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center product-list-item py-2">
                                <span class="badge bg-primary me-2">#@(index++)</span>
                                <span class="text-truncate fw-medium" style="max-width: 70%;">@urun.Key</span>
                                <span class="badge bg-success-subtle text-success fw-bold p-2">@urun.Value adet</span>
                            </li>
                        }
                    }
                    else
                    {
                        <li class="list-group-item text-center text-muted py-4">Veri bulunamadı.</li>
                    }
                </ul>
            </div>
        </div>
    </div>


    <div class="row g-4 mb-5">

        <div class="col-xl-4">
            <div class="card stat-card shadow h-100 bg-light border-0">
                <div class="card-header card-header-styled">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-infinity me-2"></i> Tüm Zamanlar Finans</h5>
                </div>
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="fw-semibold text-success">Toplam Gelir</span>
                        <h4 class="text-success fw-bold mb-0">@String.Format("{0:C}", ViewBag.ToplamGelir ?? 0)</h4>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="fw-semibold text-danger">Toplam Gider</span>
                        <h4 class="text-danger fw-bold mb-0">@String.Format("{0:C}", ViewBag.ToplamGider ?? 0)</h4>
                    </div>
                    <hr />
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-bold text-primary fs-5">NET KAR</span>
                        <h4 class="fw-bold mb-0 text-primary">@String.Format("{0:C}", (ViewBag.ToplamGelir - ViewBag.ToplamGider) ?? 0)</h4>
                    </div>
                </div>
                <a href="@Url.Action("GelirGider", "GelirGider")" class="card-footer bg-light border-0 text-primary fw-semibold text-decoration-none p-3 rounded-bottom-4">
                    Gelir/Gider Kayıtları <i class="bi bi-arrow-right-short ms-1"></i>
                </a>
            </div>
        </div>

        <div class="col-xl-8">
            <div class="card stat-card shadow h-100">
                <div class="card-header card-header-styled">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-stars me-2"></i> Yenilikler & Güncellemeler (v.4.0)</h5>
                </div>
                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>v.4.0</strong> - Tarih: 2025-09-27 | Admin ekranı iyileştirmeleri- Müşteriler ve Toptancılar.</li>
                        <li class="list-group-item"><strong>v.3.9</strong> - Tarih: 2025-09-26 | Müşteri işlemleri artık cascade satış işlemden silinen bir değer müşterinin borcundan da düşüyor. ekran düzenlemeleri yapıldı.</li>
                        <li class="list-group-item"><strong>v.3.8</strong> - Tarih: 2025-09-25 | Toptancı gelir gider takibi ana ekrana eklendi.</li>
                        <li class="list-group-item text-muted text-center">Yeni sürümde eklenenler burada listelenecek.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // Sözler
    const quotes = [
        "Sabah erken kalkmak sağlıklıdır derler; ben hâlâ araştırma aşamasındayım.",
        "Ofise gitmek için motivasyon yok ama kahve için var.",
        "Evden çalışmanın en zor yanı, buzdolabının çok yakın olması.",
        "Diyet yapıyorum; sadece pizza, hamburger ve tatlı yemiyorum… arada.",
        "Bugün spor yapacaktım, ama spor da bana gelmedi.",
        "Bir gün herkesin internetsiz kalacağına inanıyorum… ve o gün çok korkunç olacak.",
        "Kahve olmadan çalışmak, internetsiz YouTube’a girmek gibi.",
        "Sabahları uyanmak için üç alarm kurarım: uyumak, biraz daha uyumak, çok uyumak.",
        "Pazartesi, cuma kılığına girse hayat daha güzel olurdu.",
        "Ertelemek bir sanattır; ben Picasso."
        // Tamamlanmayan satırı tamamladım. İsteğe bağlı olarak daha çok söz eklenebilir.
    ];

    document.addEventListener('DOMContentLoaded', function () {
        const quoteElement = document.getElementById('dailyQuote');
        if (quoteElement) {
            // Rastgele bir söz seç
            const randomIndex = Math.floor(Math.random() * quotes.length);
            const selectedQuote = quotes[randomIndex];

            // Sözü yerleştir ve opaklığı ayarla
            quoteElement.style.opacity = '0';
            setTimeout(() => {
                quoteElement.textContent = selectedQuote;
                quoteElement.style.opacity = '1';
            }, 100); // 100ms gecikme ile geçiş efekti
        }
    });
</script>